<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bro's Games V2 Clicker</title>
  <style>
    :root{
      --bg:#111;
      --card:#1c1c1c;
      --accent:#fff;
      --muted:#999;
    }
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;color:var(--accent)}
    body{background:var(--bg);display:flex;align-items:center;justify-content:center;padding:32px}
    .wrap{width:min(920px,96vw);display:grid;grid-template-columns:1fr 380px;gap:24px;align-items:start}
    .card{background:var(--card);border-radius:14px;padding:22px;box-shadow:0 8px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.05)}
    .main{padding:28px;border-radius:12px}
    h1{margin:0 0 6px 0;font-size:22px;letter-spacing:-0.4px}
    .sub{color:var(--muted);font-size:13px;margin-bottom:18px}
    .bigcount{font-size:64px;line-height:1;font-weight:700;margin:14px 0;text-align:center}
    #clickBtn{width:100%;padding:18px;border-radius:12px;border:none;font-size:20px;font-weight:700;background:#fff;color:#111;cursor:pointer;box-shadow:0 8px 30px rgba(255,255,255,0.1);transition:0.2s}
    #clickBtn:hover{background:#eee}
    .small{font-size:13px;color:var(--muted);margin-top:10px;text-align:center}
    .progressWrap{background:rgba(255,255,255,0.03);height:18px;border-radius:12px;overflow:hidden;margin-top:12px}
    .progressInner{height:100%;width:0%;background:#fff;transition:width 350ms ease}
    .side{position:relative;padding:22px;border-radius:12px;min-height:260px;display:flex;flex-direction:column;gap:12px}
    .stat{display:flex;justify-content:space-between;align-items:center;padding:12px;background:rgba(255,255,255,0.03);border-radius:10px}
    .stat .k{font-weight:700;font-size:20px}
    .muted{color:var(--muted);font-size:13px}
    .notice{padding:12px;border-radius:10px;background:rgba(255,255,255,0.03);text-align:center}
    .coming{font-size:18px;font-weight:700;margin-top:6px}
    .tiny{font-size:12px;color:var(--muted)}
    .leaderboard{margin-top:12px}
    .leaderboard div{padding:6px;border-bottom:1px solid rgba(255,255,255,0.05)}
    footer{grid-column:1/-1;text-align:center;color:var(--muted);font-size:12px;margin-top:12px}
    @media (max-width:880px){.wrap{grid-template-columns:1fr;gap:12px}.side{order:2}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card main">
      <h1>Bro's Games V2 Clicker</h1>
      <div class="sub" id="welcomeText">loading...</div>
      <div>
        <div class="bigcount" id="count">0</div>
        <button id="clickBtn">click me</button>
        <div class="small">realtime shared counter</div>
        <div class="progressWrap"><div id="progress" class="progressInner"></div></div>
      </div>
    </div>

    <div class="card side">
      <div class="stat">
        <div><div class="muted">goal</div><div class="k">1,000,000</div></div>
        <div style="text-align:right"><div class="muted">status</div><div id="status" class="k">waiting</div></div>
      </div>

      <div class="notice">
        <div class="muted">leaderboard</div>
        <div id="leaderboard" class="leaderboard"></div>
      </div>
    </div>
    <footer>click like your life depends on it</footer>
  </div>

  <!-- firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCB63EYBBSih6ygSahhC4cOWtQ-1Ocnl1k",
      authDomain: "clicker-1mil.firebaseapp.com",
      projectId: "clicker-1mil",
      storageBucket: "clicker-1mil.firebasestorage.app",
      messagingSenderId: "58236696117",
      appId: "1:58236696117:web:d204b9638fc382b497637c",
      measurementId: "G-3DBR2BJJGZ",
      databaseURL: "https://clicker-1mil-default-rtdb.firebaseio.com/"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const rootRef = db.ref("globalClicker");
    const usersRef = rootRef.child("users");
    const countEl = document.getElementById("count");
    const progressEl = document.getElementById("progress");
    const statusEl = document.getElementById("status");
    const leaderboardEl = document.getElementById("leaderboard");
    const welcomeText = document.getElementById("welcomeText");
    const btn = document.getElementById("clickBtn");
    const GOAL = 1_000_000;

    // get username or ask
    let username = localStorage.getItem("bg2_username");
    if(!username){
      username = prompt("choose a username") || "anon";
      localStorage.setItem("bg2_username", username);
    }
    welcomeText.textContent = `welcome, ${username}`;

    const updateUI = (data) => {
      const count = Number(data.count || 0);
      countEl.textContent = count.toLocaleString();
      progressEl.style.width = Math.min(100, (count / GOAL) * 100) + "%";
      statusEl.textContent = count >= GOAL ? "done" : "in progress";

      const users = data.users || {};
      const sorted = Object.entries(users).sort((a,b)=>b[1]-a[1]).slice(0,5);
      leaderboardEl.innerHTML = "";
      sorted.forEach(([name,c])=>{
        const div = document.createElement("div");
        div.textContent = `${name}: ${c.toLocaleString()}`;
        leaderboardEl.appendChild(div);
      });
    }

    // listen for global changes
    rootRef.on("value", snap=>{
      updateUI(snap.val() || {});
    });

    // click handler
    btn.addEventListener("click", ()=>{
      btn.disabled = true;
      rootRef.transaction((current)=>{
        current = current || {count:0, users:{}};
        current.count = (current.count||0)+1;
        current.users[username] = (current.users[username]||0)+1;
        return current;
      }, ()=>{
        btn.disabled = false;
      });
    });

    // init if empty
    rootRef.once("value").then(snap=>{
      if(!snap.exists()){
        rootRef.set({count:0, users:{}});
      }
    });
  </script>
</body>
</html>
